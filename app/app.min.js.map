{"version":3,"sources":["app.min.js"],"names":["appConfig","$stateProvider","$urlRouterProvider","cacheAll","cacheService","getUser","headerService","getUsers","userService","isAuthenticated","accessService","isAdmin","state","url","templateUrl","abstract","resolve","cache","user","views","header","controller","controllerAs","sidebar","parent","content@","users","otherwise","angular","module","config","$inject","runBlock","appService","init","run","$rootScope","$state","statusService","$on","stateChangeError","event","toState","toParams","fromState","fromParams","error","UNAUTHORIZED","preventDefault","go","name","FORBIDDEN","factory","inGroups","activities","groups","activitiesInGroups","i","length","label_id","calendar_id","push","filter","sameDayAs","moment","events","day","sameDayEvents","result","isSame","dt_start","dt_end","withinDays","tasks","numOfDays","tasksWithinDays","due","isBefore","add","GroupPageController","$stateParams","this","groupId","crudService","cacheCalendars","cacheEvents","cacheLabels","cacheTasks","vm","calendar","getByUser","then","response","calendars","getResult","updateCalendars","updateEvents","label","labels","updateLabels","task","updateTasks","clearCache","data","success","title","getAll","getCalendars","getEvents","getLabels","getTasks","$broadcast","service","$http","$log","type","base","get","id","params","promiseComplete","promiseFailed","byUser","getWhere","where","bindings","JSON","stringify","create","removeUnecessaryKeys","post","update","put","remove","removeWhere","escape","message","toDelete","crud","prototype","sessionService","getVar","$name","setVar","$value","autoFocusDirective","link","scope","element","attrs","ngModel","focus","restrict","directive","compareToDirective","cleanUp","unbindWatch","compareValues","viewValue","otherModel","$viewValue","validateOnChange","newValue","oldValue","$validate","$watch","$validators","spCompareTo","on","require","LogoutController","logoutService","activate","logout","logoutComplete","logoutFailed","formatService","formatForDisplay","activity","hasOwnProperty","all_day","parseInt","toDisplayFormat","reminder","formatForStorage","displayFormat","getDisplayFormat","toStorageFormat","format","ModalController","$uibModalInstance","item","eventModalService","cancel","dismiss","close","confirm","toggleAllDay","UploadController","$scope","uploadService","uploadFile","file","oldFile","filePath","uc","uploadDirective","$parse","fileHandler","$apply","files","size","maxFileSize","spFileChange","alert","addEventListener","formData","FormData","append","transformRequest","identity","headers","Content-Type","undefined","res","AdminController","userModalService","showUserModal","openUserModal","LoginController","loginService","login","loading","loginComplete","loginFailed","toLowerCase","trim","RegisterController","registerService","register","registrationComplete","$q","isAuthenticatedComplete","deferred","OK","reject","promise","isAdminComplete","defer","EventsController","calendarWidgetService","calendarService","eventsService","today","getToday","selectedDay","month","getMonth","dayClicked","clickEvent","isSameDayAsSelected","isSameDay","showEventModal","lastMonth","nextMonth","eventsDirective","bindToController","inCalendars","createEvent","createOrUpdateEvent","event_id","updateEvent","deleteEvent","RecurrenceController","recurrenceModalService","showRecurrenceModal","rc","recurrence","openRecurrenceModal","recurrenceDirective","recurrenceService","clearRecurrence","constructRecurrence","TasksController","tasksService","labelService","taskModalService","showTaskModal","openTaskModal","toggleCompleted","tasksDirective","order","days","inLabels","createTask","createOrUpdateTask","task_id","updateTask","deleteTask","completed","calendarUserService","createCalendarUser","calendarUser","createOrUpdateCalendarUser","calendarUser_id","updateCalendarUser","deleteCalendarUser","getSharedCalendars","getSharedUsersForCalendar","getEventsForCalendar","labelUserService","createLabelUser","labelUser","createOrUpdateLabelUser","labelUser_id","updateLabelUser","deleteLabelUser","getSharedLabels","getSharedUsersForLabel","getEventsForLabel","collabModalService","$uibModal","openCollabModal","clonedItem","extend","open","Number","clonedUser","createOrUpdateUser","deleteUser","createUser","updateUser","HeaderController","getNameComplete","avatar","SidebarController","sidebarService","collapsed","getCollapsed","toggleSidebar","toggleCalendars","toggleLabels","$window","innerWidth","createCalendar","deleteCalendar","updateCalendar","openEventModal","clonedEvent","display","startOf","endOf","currentHour","hour","fullDate","clone","aDay","date","getWeek","startDay","targetMonth","week","number","isTargetMonth","isToday","day1","day2","srcMonth","subtract","stopPropagation","recurrenceInfo","freq","createLabel","deleteLabel","updateLabel","subtaskModalService","subtasksService","openSubtaskModal","subtask","clonedSubtask","createOrUpdateSubtask","deleteSubtask","clonedTask","SubtasksController","showSubtaskModal","st","subtasksDirective","subtasks","currentId","list","splice","indexOf"],"mappings":"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","file":"app.min.js","sourcesContent":["(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app', ['ui.router', 'ui.bootstrap', 'angularMoment'])\r\n\t\t.config(appConfig);\r\n\r\n\tappConfig.$inject = ['$stateProvider', '$urlRouterProvider'];\r\n\tfunction appConfig($stateProvider, $urlRouterProvider) {\r\n\r\n\t\t$stateProvider\r\n\t\t\t.state('root', {\r\n\t\t\t\turl: '',\r\n\t\t\t\ttemplateUrl: 'index.html',\r\n\t\t\t\tabstract: true,\r\n\t\t\t\tresolve: {\r\n\t\t\t\t\tcache: ['cacheService', cacheAll],\r\n\t\t\t\t\tuser: ['headerService', getUser]\r\n\t\t\t\t},\r\n\t\t\t\tviews: {\r\n\t\t\t\t\t'header': {\r\n\t\t\t\t\t\ttemplateUrl: 'pages/layout/header/header.html',\r\n\t\t\t\t\t\tcontroller: 'HeaderController',\r\n\t\t\t\t\t\tcontrollerAs: 'hc'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t'sidebar': {\r\n\t\t\t\t\t\ttemplateUrl: 'pages/layout/sidebar/sidebar.html',\r\n\t\t\t\t\t\tcontroller: 'SidebarController',\r\n\t\t\t\t\t\tcontrollerAs: 'sc'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.state('login', {\r\n\t\t\t\turl: '/login',\r\n\t\t\t\tparent: 'root',\r\n\t\t\t\tviews: {\r\n\t\t\t\t\t'content@': {\r\n\t\t\t\t\t\ttemplateUrl: 'pages/login/login.html',\r\n\t\t\t\t\t\tcontroller: 'LoginController',\r\n\t\t\t\t\t\tcontrollerAs: 'vm'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.state('logout', {\r\n\t\t\t\turl: '/logout',\r\n\t\t\t\tparent: 'root',\r\n\t\t\t\tviews: {\r\n\t\t\t\t\t'content@': {\r\n\t\t\t\t\t\tcontroller: 'LogoutController',\r\n\t\t\t\t\t\tcontrollerAs: 'vm'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.state('register', {\r\n\t\t\t\turl: '/register',\r\n\t\t\t\tparent: 'root',\r\n\t\t\t\tviews: {\r\n\t\t\t\t\t'content@': {\r\n\t\t\t\t\t\ttemplateUrl: 'pages/register/register.html',\r\n\t\t\t\t\t\tcontroller: 'RegisterController',\r\n\t\t\t\t\t\tcontrollerAs: 'vm'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.state('admin', {\r\n\t\t\t\turl: '/admin',\r\n\t\t\t\tparent: 'root',\r\n\t\t\t\tviews: {\r\n\t\t\t\t\t'content@': {\r\n\t\t\t\t\t\ttemplateUrl: 'pages/admin/admin.html',\r\n\t\t\t\t\t\tcontroller: 'AdminController',\r\n\t\t\t\t\t\tcontrollerAs: 'vm',\r\n\t\t\t\t\t\tresolve: {\r\n\t\t\t\t\t\t\tisAuthenticated: ['accessService', isAuthenticated],\r\n\t\t\t\t\t\t\tisAdmin: ['accessService', isAdmin],\r\n\t\t\t\t\t\t\tusers: ['userService', getUsers]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.state('dashboard', {\r\n\t\t\t\turl: '/dashboard',\r\n\t\t\t\tparent: 'root',\r\n\t\t\t\tviews: {\r\n\t\t\t\t\t'content@': {\r\n\t\t\t\t\t\ttemplateUrl: 'pages/dashboard/dashboard.html',\r\n\t\t\t\t\t\tresolve: {\r\n\t\t\t\t\t\t\tisAuthenticated: ['accessService', isAuthenticated]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.state('calendars', {\r\n\t\t\t\turl: '/calendars',\r\n\t\t\t\tparent: 'root'\r\n\t\t\t})\r\n\t\t\t\t.state('calendars.calendar', {\r\n\t\t\t\t\turl: '/:groupId',\r\n\t\t\t\t\tviews: {\r\n\t\t\t\t\t\t'content@': {\r\n\t\t\t\t\t\t\ttemplateUrl: \"pages/calendar/calendar.html\",\r\n\t\t\t\t\t\t\tcontroller: 'GroupPageController',\r\n\t\t\t\t\t\t\tcontrollerAs: 'vm',\r\n\t\t\t\t\t\t\tresolve: {\r\n\t\t\t\t\t\t\t\tisAuthenticated: ['accessService', isAuthenticated]\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t.state('labels', {\r\n\t\t\t\turl: '/labels',\r\n\t\t\t\tparent: 'root'\r\n\t\t\t})\r\n\t\t\t\t.state('labels.label', {\r\n\t\t\t\t\turl: '/:groupId',\r\n\t\t\t\t\tviews: {\r\n\t\t\t\t\t\t'content@': {\r\n\t\t\t\t\t\t\ttemplateUrl: \"pages/tasks/label.html\",\r\n\t\t\t\t\t\t\tcontroller: 'GroupPageController',\r\n\t\t\t\t\t\t\tcontrollerAs: 'vm',\r\n\t\t\t\t\t\t\tresolve: {\r\n\t\t\t\t\t\t\t\tisAuthenticated: ['accessService', isAuthenticated]\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t.state('inbox', {\r\n\t\t\t\turl: '/inbox',\r\n\t\t\t\tparent: 'root',\r\n\t\t\t\tviews: {\r\n\t\t\t\t\t'content@': {\r\n\t\t\t\t\t\ttemplateUrl: 'pages/tasks/inbox.html',\r\n\t\t\t\t\t\tresolve: {\r\n\t\t\t\t\t\t\tisAuthenticated: ['accessService', isAuthenticated]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.state('today', {\r\n\t\t\t\turl: '/today',\r\n\t\t\t\tparent: 'root',\r\n\t\t\t\tviews: {\r\n\t\t\t\t\t'content@': {\r\n\t\t\t\t\t\ttemplateUrl: 'pages/tasks/today.html',\r\n\t\t\t\t\t\tresolve: {\r\n\t\t\t\t\t\t\tisAuthenticated: ['accessService', isAuthenticated]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.state('week', {\r\n\t\t\t\turl: '/week',\r\n\t\t\t\tparent: 'root',\r\n\t\t\t\tviews: {\r\n\t\t\t\t\t'content@': {\r\n\t\t\t\t\t\ttemplateUrl: 'pages/tasks/week.html',\r\n\t\t\t\t\t\tresolve: {\r\n\t\t\t\t\t\t\tisAuthenticated: ['accessService', isAuthenticated]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.state('calendar', {\r\n\t\t\t\turl: '/calendar',\r\n\t\t\t\tparent: 'root',\r\n\t\t\t\tviews: {\r\n\t\t\t\t\t'content@': {\r\n\t\t\t\t\t\ttemplateUrl: 'pages/calendar/calendar.html',\r\n\t\t\t\t\t\tresolve: {\r\n\t\t\t\t\t\t\tisAuthenticated: ['accessService', isAuthenticated]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t$urlRouterProvider.otherwise('/dashboard');\r\n\r\n\t\tfunction cacheAll(cacheService) {\r\n\t\t\treturn cacheService.cacheAll();\r\n\t\t}\r\n\r\n\t\tfunction getSharedCalendars(calendarUserService) {\r\n\t\t\treturn calendarUserService.getSharedCalendars();\r\n\t\t}\r\n\r\n\t\tfunction getSharedLabels(labelUserService) {\r\n\t\t\treturn labelUserService.getSharedLabels();\r\n\t\t}\r\n\r\n\t\tfunction getUser(headerService) {\r\n\t\t\treturn headerService.getUser();\r\n\t\t}\r\n\r\n\t\tfunction getUsers(userService) {\r\n\t\t\treturn userService.getUsers();\r\n\t\t}\r\n\r\n\t\tfunction isAuthenticated(accessService) {\r\n\t\t\treturn accessService.isAuthenticated();\r\n\t\t}\r\n\r\n\t\tfunction isAdmin(accessService) {\r\n\t\t\treturn accessService.isAdmin();\r\n\t\t}\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.run(runBlock);\r\n\r\n\trunBlock.$inject = ['appService'];\r\n\tfunction runBlock(appService) {\r\n\t\tappService.init();\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('appService', appService);\r\n\r\n\tappService.$inject = ['$rootScope', '$state', 'statusService'];\r\n\tfunction appService($rootScope, $state, statusService) {\r\n\t\treturn {\r\n\t\t\tinit: init\r\n\t\t};\r\n\r\n\t\tfunction init() {\r\n\t\t\t$rootScope.$on('$stateChangeError', stateChangeError);\r\n\t\t}\r\n\r\n\t\tfunction stateChangeError(event, toState, toParams, fromState, fromParams, error) {\r\n\t\t\tif (error === statusService.UNAUTHORIZED) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\t$state.go('login');\r\n\t\t\t} else if (toState.name === 'admin' && error === statusService.FORBIDDEN) {\r\n\t\t\t\t// event.preventDefault();\r\n\t\t\t\t// $state.go('dashboard');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.filter('inGroups', inGroups);\r\n\r\n\tinGroups.$inject = [];\r\n\tfunction inGroups() {\r\n\t\treturn function(activities, groups) {\r\n\t\t\tif (!groups) {\r\n\t\t\t\treturn activities;\r\n\t\t\t}\r\n\r\n\t\t\tvar activitiesInGroups = [];\r\n\r\n\t\t\tfor (var i = 0; i < activities.length; i++) {\r\n\t\t\t\tif (activities[i].label_id === groups ||\r\n\t\t\t\t\tactivities[i].calendar_id === groups\r\n\t\t\t\t) {\r\n\t\t\t\t\tactivitiesInGroups.push(activities[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn activitiesInGroups;\r\n\t\t};\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.filter('sameDayAs', sameDayAs);\r\n\r\n\tsameDayAs.$inject = ['moment'];\r\n\tfunction sameDayAs(moment) {\r\n\t\treturn function(events, day) {\r\n\t\t\tvar sameDayEvents = [];\r\n\r\n\t\t\tfor (var i = 0; i < events.length; i++) {\r\n\t\t\t\tvar result = day.isSame(moment(events[i].dt_start), 'day');\r\n\r\n\t\t\t\tif (!result) {\r\n\t\t\t\t\tresult = day.isSame(moment(events[i].dt_end), 'day');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(result) {\r\n\t\t\t\t\tsameDayEvents.push(events[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn sameDayEvents;\r\n\t\t};\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.filter('withinDays', withinDays);\r\n\r\n\twithinDays.$inject = ['moment'];\r\n\tfunction withinDays(moment) {\r\n\t\treturn function(tasks, numOfDays) {\r\n\t\t\tif (!numOfDays) {\r\n\t\t\t\treturn tasks;\r\n\t\t\t}\r\n\r\n\t\t\tvar tasksWithinDays = [];\r\n\r\n\t\t\tfor (var i = 0; i < tasks.length; i++) {\r\n\t\t\t\tvar result;\r\n\r\n\t\t\t\tif (!tasks[i].due || (tasks[i].due &&\r\n\t\t\t\t\tmoment(tasks[i].due).isBefore(moment().add(numOfDays, 'days')))\r\n\t\t\t\t) {\r\n\t\t\t\t\ttasksWithinDays.push(tasks[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn tasksWithinDays;\r\n\t\t};\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.controller('GroupPageController', GroupPageController);\r\n\r\n\tGroupPageController.$inject = ['$stateParams'];\r\n\tfunction GroupPageController($stateParams) {\r\n\t\tthis.groupId = $stateParams.groupId;\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.service('cacheService', cacheService);\r\n\r\n\tcacheService.$inject = ['$rootScope', 'crudService'];\r\n\tfunction cacheService($rootScope, crudService) {\r\n\t\tvar vm = this; // jshint ignore: line\r\n\t\tvm.calendars = [];\r\n\t\tvm.events = [];\r\n\t\tvm.labels = [];\r\n\t\tvm.tasks = [];\r\n\r\n\t\treturn {\r\n\t\t\tcacheAll: cacheAll,\r\n\t\t\tcacheCalendars: cacheCalendars,\r\n\t\t\tcacheEvents: cacheEvents,\r\n\t\t\tcacheLabels: cacheLabels,\r\n\t\t\tcacheTasks: cacheTasks,\r\n\t\t\tclearCache: clearCache,\r\n\r\n\t\t\tgetAll: getAll,\r\n\t\t\tgetCalendars: getCalendars,\r\n\t\t\tgetEvents: getEvents,\r\n\t\t\tgetLabels: getLabels,\r\n\t\t\tgetTasks: getTasks\r\n\t\t};\r\n\r\n\t\t// TODO: Ideally one API call.\r\n\t\tfunction cacheAll() {\r\n\t\t\tcacheCalendars();\r\n\t\t\tcacheEvents();\r\n\t\t\tcacheLabels();\r\n\t\t\tcacheTasks();\r\n\t\t}\r\n\r\n\t\tfunction cacheCalendars() {\r\n\t\t\tvm.calendar = new crudService('calendar');\r\n\t\t\tvm.calendar.getByUser()\r\n\t\t\t\t.then(function(response) {\r\n\t\t\t\t\tvm.calendars = getResult(response);\r\n\t\t\t\t\tupdateCalendars();\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction cacheEvents() {\r\n\t\t\tvm.event = new crudService('event');\r\n\t\t\tvm.event.getByUser()\r\n\t\t\t\t.then(function(response) {\r\n\t\t\t\t\tvm.events = getResult(response);\r\n\t\t\t\t\tupdateEvents();\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction cacheLabels() {\r\n\t\t\tvm.label = new crudService('label');\r\n\t\t\tvm.label.getByUser()\r\n\t\t\t\t.then(function(response) {\r\n\t\t\t\t\tvm.labels = getResult(response);\r\n\t\t\t\t\tupdateLabels();\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction cacheTasks() {\r\n\t\t\tvm.task = new crudService('task');\r\n\t\t\tvm.task.getByUser()\r\n\t\t\t\t.then(function(response) {\r\n\t\t\t\t\tvm.tasks = getResult(response);\r\n\t\t\t\t\tupdateTasks();\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction clearCache() {\r\n\t\t\tvm.calendars = [];\r\n\t\t\tvm.events = [];\r\n\t\t\tvm.labels = [];\r\n\t\t\tvm.tasks = [];\r\n\r\n\t\t\tupdateCalendars();\r\n\t\t\tupdateEvents();\r\n\t\t\tupdateLabels();\r\n\t\t\tupdateTasks();\r\n\t\t}\r\n\r\n\t\tfunction getResult(response) {\r\n\t\t\tvar result = response.data;\r\n\t\t\treturn result.success ? result.data : result.title;\r\n\t\t}\r\n\r\n\t\tfunction getAll() {\r\n\t\t\treturn {\r\n\t\t\t\tcalendars: getCalendars(),\r\n\t\t\t\tevents: getEvents(),\r\n\t\t\t\tlabels: getLabels(),\r\n\t\t\t\ttasks: getTasks()\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tfunction getCalendars() {\r\n\t\t\treturn vm.calendars;\r\n\t\t}\r\n\r\n\t\tfunction getEvents() {\r\n\t\t\treturn vm.events;\r\n\t\t}\r\n\r\n\t\tfunction getLabels() {\r\n\t\t\treturn vm.labels;\r\n\t\t}\r\n\r\n\t\tfunction getTasks() {\r\n\t\t\treturn vm.tasks;\r\n\t\t}\r\n\r\n\t\tfunction updateCalendars() {\r\n\t\t\t$rootScope.$broadcast('updateCalendars');\r\n\t\t}\r\n\r\n\t\tfunction updateEvents() {\r\n\t\t\t$rootScope.$broadcast('updateEvents');\r\n\t\t}\r\n\r\n\t\tfunction updateLabels() {\r\n\t\t\t$rootScope.$broadcast('updateLabels');\r\n\t\t}\r\n\r\n\t\tfunction updateTasks() {\r\n\t\t\t$rootScope.$broadcast('updateTasks');\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\t/**\r\n\t* Used to access the api of the various item types.\r\n\t* An instance of crud must be created in order to use the service.\r\n\t*\r\n\t* All promises return 'success' and either 'data' on success or, on error, 'title'\r\n\t* with a general error and 'details' with more details.\r\n\t*/\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('crudService', crudService);\r\n\r\n\tcrudService.$inject = ['$http', '$log'];\r\n\tfunction crudService($http, $log) {\r\n\t\tvar crud = init;\r\n\t\tcrud.prototype = {\r\n\t\t\tget: get,\r\n\t\t\tgetByUser: getByUser,\r\n\t\t\tgetWhere: getWhere,\r\n\t\t\tcreate: create,\r\n\t\t\tupdate: update,\r\n\t\t\tremove: remove,\r\n\t\t\tremoveWhere: removeWhere,\r\n\t\t\tremoveUnecessaryKeys: removeUnecessaryKeys\r\n\t\t};\r\n\r\n\t\treturn crud;\r\n\r\n\t\t/**\r\n\t\t* Initialize the base url using the type of item to be called on.\r\n\t\t* Activities and their parents have a specific subfolder to be pointed to,\r\n\t\t* while others do not.\r\n\t\t*\r\n\t\t* @param {string} type Type of item.\r\n\t\t*/\r\n\t\tfunction init(type) {\r\n\t\t\t/* jshint ignore:start */\r\n\t\t\tthis.type = type;\r\n\t\t\tthis.base = 'api/';\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 'event':\r\n\t\t\t\tcase 'calendar':\r\n\t\t\t\t\tthis.base += 'activity/calendar/';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'label':\r\n\t\t\t\tcase 'task':\r\n\t\t\t\t\tthis.base += 'activity/task/';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'labelUser':\r\n\t\t\t\tcase 'calendarUser':\r\n\t\t\t\t\tthis.base += 'collab/';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthis.base += type + '/';\r\n\t\t\t}\r\n\t\t\tthis.base += type + 'Manager.php';\r\n\t\t\t/* jshint ignore:end */\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t* @param\t{string}\tid\t\tID of item type to get.\r\n\t\t* @return\t{string[]}\t\t\tPromise with 'data' == query results on success.\r\n\t\t*/\r\n\t\tfunction get(id) {\r\n\t\t\treturn $http.get(this.base, {params: { id: id }}) // jshint ignore:line\r\n\t\t\t\t.then(promiseComplete)\r\n\t\t\t\t.catch(promiseFailed);\r\n\t\t}\r\n\t\t/**\r\n\t\t* @return\t{string[]}\t\t\tPromise with 'data' == query results on success.\r\n\t\t*/\r\n\t\tfunction getByUser() {\r\n\t\t\treturn $http.get(this.base, {params: {byUser: true}}) // jshint ignore:line\r\n\t\t\t\t.then(promiseComplete)\r\n\t\t\t\t.catch(promiseFailed);\r\n\t\t}\r\n\r\n\t\tfunction getWhere(where, bindings) {\r\n\t\t\treturn $http.get(this.base, {params: { where: where, bindings: JSON.stringify(bindings) }}) // jshint ignore:line\r\n\t\t\t\t.then(promiseComplete)\r\n\t\t\t\t.catch(promiseFailed);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t* @param\t{mixed[]}\tdata\tData of item to create.\r\n\t\t* @return\t{string[]}\t\t\tPromise with 'data' === 1 on success.\r\n\t\t*/\r\n\t\tfunction create(data) {\r\n\t\t\tdata = this.removeUnecessaryKeys(data);  // jshint ignore:line\r\n\t\t\treturn $http.post(this.base, data) // jshint ignore:line\r\n\t\t\t\t.then(promiseComplete)\r\n\t\t\t\t.catch(promiseFailed);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t* @param\t{string}\tid\t\tID of item type to update.\r\n\t\t* @param\t{mixed[]}\tdata\tData of item to update.\r\n\t\t*\r\n\t\t* @return\t{string[]}\t\t\tPromise with 'data' === '1' on success.\r\n\t\t*/\r\n\t\tfunction update(id, data) {\r\n\t\t\tdata = this.removeUnecessaryKeys(data);  // jshint ignore:line\r\n\t\t\treturn $http.put(this.base, data, {params: { id: id }}) // jshint ignore:line\r\n\t\t\t\t.then(promiseComplete)\r\n\t\t\t\t.catch(promiseFailed);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t* @param\t{string}\tid\t\tID of item type to delete.\r\n\t\t* @return\t{string[]}\t\t\tPromise with 'data' === 1 on success.\r\n\t\t*/\r\n\t\tfunction remove(id) {\r\n\t\t\treturn $http.delete(this.base, {params: { id: id }}) // jshint ignore:line\r\n\t\t\t\t.then(promiseComplete)\r\n\t\t\t\t.catch(promiseFailed);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t* @param \t{string}\twhere \tWhere clause.\r\n\t\t* @return\t{string[]}\t\t\tPromise with 'data' >= 0 on success.\r\n\t\t*/\r\n\t\tfunction removeWhere(where) {\r\n\t\t\treturn $http.delete(this.base + '?usewhere=true&where=' + escape(where)) // jshint ignore:line\r\n\t\t\t\t.then(promiseComplete)\r\n\t\t\t\t.catch(promiseFailed);\r\n\t\t}\r\n\r\n\t\tfunction promiseComplete(response) {\r\n\t\t\treturn response;\r\n\t\t}\r\n\r\n\t\tfunction promiseFailed(error) {\r\n\t\t\t$log.error(error);\r\n\t\t\treturn {\r\n\t\t\t\tsuccess: 'false',\r\n\t\t\t\ttitle: 'Error when querying server.',\r\n\t\t\t\tmessage: error\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t* Item data passed in may still have their ids or alias fields (for activities)\r\n\t\t* embedded, which will can cause errors in the SQL.\r\n\t\t*\r\n\t\t* @param\t{mixed[]} data\r\n\t\t* @return\t{mixed[]}\r\n\t\t*/\r\n\t\tfunction removeUnecessaryKeys(data) {\r\n\t\t\tvar toDelete = ['id', 'person_id', this.type + '_id', 'activity_info_id', 'parent_name'];  // jshint ignore:line\r\n\t\t\tfor (var i = 0; i < toDelete.length; i++) {\r\n\t\t\t\tdelete data[toDelete[i]];\r\n\t\t\t}\r\n\t\t\treturn data;\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\t/**\r\n\t* Used to access session variables.\r\n\t*/\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('sessionService', sessionService);\r\n\r\n\tsessionService.$inject = ['$http', '$log'];\r\n\tfunction sessionService($http, $log) {\r\n\t\tvar vm = this;  // jshint ignore:line\r\n\t\tvm.base = 'api/session/sessionVarManager.php?var=';\r\n\r\n\t\treturn {\r\n\t\t\tgetVar: getVar,\r\n\t\t\tsetVar: setVar\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t* @param\t{string} $name\tVariable name to get from session.\r\n\t\t* @return\t{string} \t\tPromise or error on fail.\r\n\t\t*/\r\n\t\tfunction getVar($name) {\r\n\t\t\treturn $http.get(vm.base + $name)\r\n\t\t\t\t.then(promiseComplete)\r\n\t\t\t\t.catch(promiseFailed);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t* @param\t{string} $name\tVariable name to get from session.\r\n\t\t* @return\t{string} \t\tPromise or error on fail.\r\n\t\t*/\r\n\t\tfunction setVar($name, $value) {\r\n\t\t\treturn $http.post(vm.base + $name, $value)\r\n\t\t\t\t.then(promiseComplete)\r\n\t\t\t\t.catch(promiseFailed);\r\n\t\t}\r\n\r\n\t\tfunction promiseComplete(response) {\r\n\t\t\treturn response;\r\n\t\t}\r\n\r\n\t\tfunction promiseFailed(error) {\r\n\t\t\t$log.error(error);\r\n\t\t\treturn {\r\n\t\t\t\tsuccess: 'false',\r\n\t\t\t\ttitle: 'Error when accessing variable.',\r\n\t\t\t\tmessage: error\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\t/**\r\n\t* To be used in conjunction with autofocus attribute to auto-focus\r\n\t* modal inputs.\r\n\t*/\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.directive('spAutoFocus', autoFocusDirective);\r\n\r\n\tfunction autoFocusDirective() {\r\n\t\treturn {\r\n\t\t\trestrict: 'A',\r\n\t\t\tlink: link\r\n\t\t};\r\n\r\n\t\tfunction link(scope, element, attrs, ngModel) {\r\n\t\t\telement[0].focus();\r\n\t\t}\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\t/**\r\n\t* Compare an input field to another field, determined by the dev.\r\n\t*/\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.directive('spCompareTo', compareToDirective);\r\n\r\n\tfunction compareToDirective() {\r\n\t\treturn {\r\n\t\t\trequire: 'ngModel',\r\n\t\t\tscope: {\r\n\t\t\t\totherModel: '=spCompareTo'\r\n\t\t\t},\r\n\t\t\tlink: link\r\n\t\t};\r\n\r\n\t\tfunction link(scope, element, attrs, ngModel) {\r\n\t\t\tvar unbindWatch = scope.$watch('otherModel', validateOnChange);\r\n\t\t\tngModel.$validators.spCompareTo = compareValues;\r\n\t\t\telement.on('$destroy', cleanUp);\r\n\r\n\t\t\tfunction cleanUp() {\r\n\t\t\t\tunbindWatch();\r\n\t\t\t}\r\n\r\n\t\t\tfunction compareValues(viewValue) {\r\n\t\t\t\treturn (viewValue === scope.otherModel.$viewValue);\r\n\t\t\t}\r\n\r\n\t\t\tfunction validateOnChange(newValue, oldValue) {\r\n\t\t\t\tngModel.$validate();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.controller('LogoutController', LogoutController);\r\n\r\n\tLogoutController.$inject = ['logoutService'];\r\n\tfunction LogoutController(logoutService) {\r\n\t\tactivate();\r\n\r\n\t\tfunction activate() {\r\n\t\t\tlogoutService.logout();\r\n\t\t}\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('logoutService', logoutService);\r\n\r\n\tlogoutService.$inject = ['$rootScope', '$http', '$state', '$log', 'cacheService'];\r\n\tfunction logoutService($rootScope, $http, $state, $log, cacheService) {\r\n\t\treturn {\r\n\t\t\tlogout: logout\r\n\t\t};\r\n\r\n\t\tfunction logout() {\r\n\t\t\treturn $http.post('api/user/logoutManager.php')\r\n\t\t\t\t.then(logoutComplete)\r\n\t\t\t\t.catch(logoutFailed);\r\n\r\n\t\t\tfunction logoutComplete(response) {\r\n\t\t\t\tcacheService.clearCache();\r\n\t\t\t\t$rootScope.$broadcast('updateUser');\r\n\t\t\t\t$state.go('login');\r\n\t\t\t}\r\n\r\n\t\t\tfunction logoutFailed(error) {\r\n\t\t\t\t$log.error(error);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\t/**\r\n\t* The formats of the task and event modals.\r\n\t* Display format is used for a user-friendly date.\r\n\t* Storage format is used to store into the database.\r\n\t*/\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('formatService', formatService);\r\n\r\n\tformatService.$inject = ['moment'];\r\n\tfunction formatService(moment) {\r\n\t\treturn {\r\n\t\t\tformatForDisplay: formatForDisplay,\r\n\t\t\tformatForStorage: formatForStorage,\r\n\t\t\tgetDisplayFormat: getDisplayFormat,\r\n\t\t\ttoDisplayFormat: toDisplayFormat,\r\n\t\t\ttoStorageFormat: toStorageFormat\r\n\t\t};\r\n\r\n\t\tfunction formatForDisplay(activity) {\r\n\t\t\tif (activity.hasOwnProperty('dt_start')) {\r\n\t\t\t\tactivity.all_day = parseInt(activity.all_day);\r\n\t\t\t\tactivity.dt_start = toDisplayFormat(moment(activity.dt_start));\r\n\t\t\t\tactivity.dt_end = toDisplayFormat(moment(activity.dt_end));\r\n\t\t\t} else {\r\n\t\t\t\tif (activity.hasOwnProperty('due') && activity.due) {\r\n\t\t\t\t\tactivity.due = toDisplayFormat(moment(activity.due));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (activity.hasOwnProperty('reminder') && activity.reminder) {\r\n\t\t\t\t\tactivity.reminder = toDisplayFormat(moment(activity.reminder));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction formatForStorage(activity) {\r\n\t\t\tvar displayFormat = getDisplayFormat();\r\n\t\t\tif (activity.hasOwnProperty('dt_start')) {\r\n\t\t\t\tactivity.dt_start = toStorageFormat(moment(activity.dt_start, displayFormat));\r\n\t\t\t\tactivity.dt_end = toStorageFormat(moment(activity.dt_end, displayFormat));\r\n\t\t\t} else {\r\n\t\t\t\tif (activity.hasOwnProperty('due') && activity.due) {\r\n\t\t\t\t\tactivity.due = toStorageFormat(moment(activity.due, displayFormat));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (activity.hasOwnProperty('reminder') && activity.reminder) {\r\n\t\t\t\t\tactivity.reminder = toStorageFormat(moment(activity.reminder, displayFormat));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn activity;\r\n\t\t}\r\n\r\n\t\tfunction getDisplayFormat() {\r\n\t\t\treturn 'hh:mm a MM-DD-YYYY';\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t* @param {moment Object} activity\r\n\t\t*/\r\n\t\tfunction toDisplayFormat(activity) {\r\n\t\t\treturn activity.format(getDisplayFormat());\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t* @param {moment Object} activity\r\n\t\t*/\r\n\t\tfunction toStorageFormat(activity) {\r\n\t\t\treturn activity.format('YYYY-MM-DD HH:mm:ss');\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.controller('ModalController', ModalController);\r\n\r\n\tModalController.$inject = ['$uibModalInstance', 'groups', 'item', 'eventModalService'];\r\n\tfunction ModalController($uibModalInstance, groups, item, eventModalService) {\r\n\t\tvar vm = this;\r\n\t\tvm.groups = groups;\r\n\t\tvm.item = item;\r\n\r\n\t\tvm.cancel = cancel;\r\n\t\tvm.close = close;\r\n\t\tvm.confirm = confirm;\r\n\t\tvm.remove = remove;\r\n\t\tvm.toggleAllDay = toggleAllDay;\r\n\r\n\t\tfunction cancel() {\r\n\t\t\t$uibModalInstance.dismiss('cancel');\r\n\t\t}\r\n\r\n\t\tfunction close() {\r\n\t\t\t$uibModalInstance.close();\r\n\t\t}\r\n\r\n\t\tfunction confirm(data) {\r\n\t\t\t$uibModalInstance.close(data);\r\n\t\t}\r\n\r\n\t\tfunction remove(data) {\r\n\t\t\t$uibModalInstance.dismiss(data);\r\n\t\t}\r\n\r\n\t\tfunction toggleAllDay(event) {\r\n\t\t\teventModalService.toggleAllDay(event);\r\n\t\t}\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.controller('UploadController', UploadController);\r\n\r\n\tUploadController.$inject = ['$scope', '$http', 'uploadService'];\r\n\tfunction UploadController($scope, $http, uploadService) {\r\n\t\tvar uc = this;\r\n\t\tuc.uploadFile = uploadFile;\r\n\r\n\t\tfunction uploadFile(file, oldFile) {\r\n\t\t\treturn uploadService.uploadFile(file)\r\n\t\t\t\t.then(function(filePath) { return filePath; });\r\n\t\t}\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.directive('spFileChange', uploadDirective);\r\n\r\n\tuploadDirective.$inject = ['$parse'];\r\n\tfunction uploadDirective($parse) {\r\n\t\treturn {\r\n\t\t\trestrict: 'A',\r\n\t\t\tcontroller: 'UploadController',\r\n\t\t\tcontrollerAs: 'uc',\r\n\t\t\tlink: link,\r\n\t\t\tscope: {\r\n\t\t\t\tspFileChange: '=',\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction link(scope, element, attrs) {\r\n\t\t\tvar maxFileSize = 2 * 1024 * 1024;\r\n\t\t\tvar fileModel = $parse(attrs.spFileChange);\r\n\t\t\telement[0].addEventListener('change', fileHandler, false);\r\n\r\n\t\t\tfunction fileHandler(event) {\r\n\t\t\t\tscope.$apply(function() {\r\n\t\t\t\t\tvar file = element[0].files[0];\r\n\r\n\t\t\t\t\tif (file.size <= maxFileSize) {\r\n\t\t\t\t\t\tscope.uc.uploadFile(file)\r\n\t\t\t\t\t\t\t.then(function(filePath) { scope.spFileChange = filePath; });\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\talert(\"File must be less than \" + (maxFileSize / 1024 / 1024) + \"MB.\");// jshint ignore:line\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('uploadService', uploadService);\r\n\r\n\tuploadService.$inject = ['$http', '$log'];\r\n\tfunction uploadService($http, $log) {\r\n\t\treturn {\r\n\t\t\tuploadFile: uploadFile\r\n\t\t};\r\n\r\n\t\tfunction uploadFile(file) {\r\n\t\t\tvar formData = new FormData();\r\n\t\t\tformData.append('file', file);\r\n\r\n\t\t\treturn $http.post('api/upload/uploadManager.php', formData, {\r\n\t\t\t\ttransformRequest: angular.identity,\r\n\t\t\t\theaders: { 'Content-Type': undefined }\r\n\t\t\t})\r\n\t\t\t\t.then(function(res) {\r\n\t\t\t\t\tif (res.data.success) {\r\n\t\t\t\t\t\treturn res.data.data;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$log.error(res.title);\r\n\t\t\t\t\treturn '';\r\n\t\t\t\t})\r\n\t\t\t\t.catch(function(res) {\r\n\t\t\t\t\t$log.error(res);\r\n\t\t\t\t});\r\n\t\t}\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.controller('AdminController', AdminController);\r\n\r\n\tAdminController.$inject = ['isAdmin', 'users', 'userService', 'userModalService'];\r\n\tfunction AdminController(isAdmin, users, userService, userModalService) {\r\n\t\tvar vm = this;\r\n\t\tvm.isAdmin = isAdmin;\r\n\t\tvm.users = users;\r\n\t\tvm.showUserModal = showUserModal;\r\n\r\n\t\tactivate();\r\n\r\n\t\tfunction activate() {\r\n\t\t}\r\n\r\n\t\tfunction getUsers() {\r\n\t\t\tuserService.getUsers().then(function(response) { vm.users = response; });\r\n\t\t}\r\n\r\n\t\tfunction showUserModal(user) {\r\n\t\t\tuserModalService.openUserModal(user)\r\n\t\t\t\t.then(function(response) { if (response) vm.users = response; });\r\n\t\t}\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.controller('LoginController', LoginController);\r\n\r\n\tLoginController.$inject = ['loginService'];\r\n\tfunction LoginController(loginService) {\r\n\t\tvar vm = this;\r\n\t\tvm.loading = false;\r\n\t\tvm.error = '';\r\n\r\n\t\tvm.login = login;\r\n\r\n\t\t/**\r\n\t\t* LoginService will redirect if there is no error. Thus, there's only a\r\n\t\t* need to return a promise if there's an error.\r\n\t\t*/\r\n\t\tfunction login() {\r\n\t\t\tvm.loading = true;\r\n\t\t\tloginService.login(vm.user)\r\n\t\t\t\t.then(function(response) {\r\n\t\t\t\t\tvm.loading = false;\r\n\t\t\t\t\tvm.error = response;\r\n\t\t\t\t});\r\n\t\t}\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('loginService', loginService);\r\n\r\n\tloginService.$inject = ['$rootScope', '$http', '$state', '$log', 'cacheService'];\r\n\tfunction loginService($rootScope, $http, $state, $log, cacheService) {\r\n\t\treturn {\r\n\t\t\tlogin: login\r\n\t\t};\r\n\r\n\t\tfunction login(user) {\r\n\t\t\tuser.name = user.name.toLowerCase().trim();\r\n\r\n\t\t\treturn $http.post('api/user/loginManager.php', user)\r\n\t\t\t\t.then(loginComplete)\r\n\t\t\t\t.catch(loginFailed);\r\n\r\n\t\t\tfunction loginComplete(response) {\r\n\t\t\t\tif (response.data.success === false) {\r\n\t\t\t\t\treturn response.data.title;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcacheService.cacheAll();\r\n\t\t\t\t$rootScope.$broadcast('updateUser');\r\n\t\t\t\t$state.go('dashboard');\r\n\t\t\t}\r\n\r\n\t\t\tfunction loginFailed(error) {\r\n\t\t\t\t$log.error(error);\r\n\t\t\t\treturn 'Something went wrong. Please try again.';\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.controller('RegisterController', RegisterController);\r\n\r\n\tRegisterController.$inject = ['registerService'];\r\n\tfunction RegisterController(registerService) {\r\n\t\tvar vm = this;\r\n\t\tvm.error = '';\r\n\t\tvm.loading = false;\r\n\t\tvm.register = register;\r\n\r\n\t\tfunction register() {\r\n\t\t\tvm.loading = true;\r\n\t\t\tregisterService.register(vm.user)\r\n\t\t\t\t.then(function(response) {\r\n\t\t\t\t\tvm.loading = false;\r\n\t\t\t\t\tvm.error = response;\r\n\t\t\t\t});\r\n\t\t}\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('registerService', registerService);\r\n\r\n\tregisterService.$inject = ['$state', '$log', 'crudService'];\r\n\tfunction registerService($state, $log, crudService) {\r\n\t\tvar vm = this;  // jshint ignore:line\r\n\t\tvm.crud = new crudService('user');\r\n\r\n\t\treturn {\r\n\t\t\tregister: register\r\n\t\t};\r\n\r\n\t\tfunction register(user) {\r\n\t\t\tuser.name = user.name.toLowerCase().trim();\r\n\r\n\t\t\treturn vm.crud.create(user)\r\n\t\t\t\t.then(registrationComplete);\r\n\r\n\t\t\tfunction registrationComplete(response) {\r\n\t\t\t\tvar result = response.data;\r\n\t\t\t\tif (!result.success) {\r\n\t\t\t\t\t$log.error(result.title);\r\n\t\t\t\t\treturn result.title;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$state.go('login');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('accessService', accessService);\r\n\r\n\taccessService.$inject = ['$q', 'sessionService', 'statusService'];\r\n\tfunction accessService($q, sessionService, statusService) {\r\n\t\tvar deferred = $q.defer();\r\n\r\n\t\treturn {\r\n\t\t\tisAuthenticated: isAuthenticated,\r\n\t\t\tisAdmin: isAdmin\r\n\t\t};\r\n\r\n\t\tfunction isAuthenticated() {\r\n\t\t\treturn sessionService.getVar('name')\r\n\t\t\t\t.then(isAuthenticatedComplete);\r\n\r\n\t\t\tfunction isAuthenticatedComplete(response) {\r\n\t\t\t\tif (response.data.success !== false) {\r\n\t\t\t\t\tdeferred.resolve(statusService.OK);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdeferred.reject(statusService.UNAUTHORIZED);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn deferred.promise;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction isAdmin() {\r\n\t\t\treturn sessionService.getVar('admin')\r\n\t\t\t\t.then(isAdminComplete);\r\n\r\n\t\t\tfunction isAdminComplete(response) {\r\n\t\t\t\tvar result = response.data;\r\n\t\t\t\tif (result.success === false || result.data === '0') {\r\n\t\t\t\t\tdeferred.reject(statusService.FORBIDDEN);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdeferred.resolve(statusService.OK);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn deferred.promise;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\t/**\r\n\t* Status codes used when accessing various pages in the app.\r\n\t*/\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.service('statusService', statusService);\r\n\r\n\tfunction statusService() {\r\n\t\treturn {\r\n\t\t\tOK: 200,\r\n\t\t\tUNAUTHORIZED: 401,\r\n\t\t\tFORBIDDEN: 403\r\n\t\t};\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.controller('EventsController', EventsController);\r\n\r\n\tEventsController.$inject = ['$rootScope', 'calendarWidgetService', 'calendarService', 'eventsService'];\r\n\tfunction EventsController($rootScope, calendarWidgetService, calendarService, eventsService) {\r\n\t\tvar vm = this;\r\n\t\tvm.events = [];\r\n\t\tvm.calendar = [];\r\n\r\n\t\tvm.today = null;\r\n\t\tvm.selectedDay = null;\r\n\t\tvm.month = null;\r\n\r\n\t\tvm.dayClicked = dayClicked;\r\n\t\tvm.isSameDayAsSelected = isSameDayAsSelected;\r\n\t\tvm.showEventModal = showEventModal;\r\n\t\tvm.lastMonth = lastMonth;\r\n\t\tvm.nextMonth = nextMonth;\r\n\r\n\t\tactivate();\r\n\r\n\t\tfunction activate() {\r\n\t\t\tupdateCalendars();\r\n\t\t\tupdateEvents();\r\n\r\n\t\t\t$rootScope.$on('updateCalendars', updateCalendars);\r\n\t\t\t$rootScope.$on('updateEvents', updateEvents);\r\n\r\n\t\t\tvm.today = calendarWidgetService.getToday();\r\n\t\t\tvm.selectedDay = vm.today;\r\n\t\t\tvm.month = calendarWidgetService.getMonth(vm.today);\r\n\t\t}\r\n\r\n\t\tfunction dayClicked(clickEvent, day) {\r\n\t\t\tvm.selectedDay = calendarWidgetService.dayClicked(clickEvent, day, vm.selectedDay, vm.calendars);\r\n\t\t}\r\n\r\n\t\tfunction isSameDayAsSelected(day) {\r\n\t\t\treturn calendarWidgetService.isSameDay(day, vm.selectedDay);\r\n\t\t}\r\n\r\n\t\tfunction showEventModal(clickEvent, event) {\r\n\t\t\tcalendarWidgetService.showEventModal(clickEvent, event, vm.calendars);\r\n\t\t}\r\n\r\n\t\tfunction lastMonth() {\r\n\t\t\tvm.month = calendarWidgetService.lastMonth(vm.month);\r\n\t\t}\r\n\r\n\t\tfunction nextMonth() {\r\n\t\t\tvm.month = calendarWidgetService.nextMonth(vm.month);\r\n\t\t}\r\n\r\n\t\tfunction updateCalendars() {\r\n\t\t\tvm.calendars = calendarService.getCalendars();\r\n\t\t}\r\n\r\n\t\tfunction updateEvents() {\r\n\t\t\tvm.events = eventsService.getEvents();\r\n\t\t}\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.directive('spEvents', eventsDirective);\r\n\r\n\tfunction eventsDirective() {\r\n\t\treturn {\r\n\t\t\ttemplateUrl: 'modules/activities/events/events.html',\r\n\t\t\tcontroller: 'EventsController',\r\n\t\t\tcontrollerAs: 'vm',\r\n\t\t\tbindToController: true,\r\n\t\t\tscope: {\r\n\t\t\t\tinCalendars: '=inGroups'\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('eventsService', eventsService);\r\n\r\n\teventsService.$inject = ['crudService', 'cacheService'];\r\n\tfunction eventsService(crudService, cacheService) {\r\n\t\tvar vm = this;  // jshint ignore:line\r\n\t\tvm.event = new crudService('event');\r\n\r\n\t\treturn {\r\n\t\t\tcreateEvent: createEvent,\r\n\t\t\tcreateOrUpdateEvent: createOrUpdateEvent,\r\n\t\t\tdeleteEvent: deleteEvent,\r\n\t\t\tgetEvents: getEvents,\r\n\t\t\tupdateEvent: updateEvent\r\n\t\t};\r\n\r\n\t\tfunction createEvent(event) {\r\n\t\t\treturn vm.event.create(event).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction createOrUpdateEvent(event) {\r\n\t\t\tif (!event.event_id) {\r\n\t\t\t\treturn createEvent(event);\r\n\t\t\t}\r\n\t\t\treturn updateEvent(event.event_id, event);\r\n\t\t}\r\n\r\n\t\tfunction deleteEvent(id) {\r\n\t\t\treturn vm.event.remove(id).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction getEvents() {\r\n\t\t\treturn cacheService.getEvents();\r\n\t\t}\r\n\r\n\t\tfunction updateEvent(id, event) {\r\n\t\t\treturn vm.event.update(id, event).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction promiseComplete(response) {\r\n\t\t\tvar res = response.data;\r\n\t\t\tif (res.success) {\r\n\t\t\t\tcacheService.cacheEvents();\r\n\t\t\t\treturn res.data;\r\n\t\t\t}\r\n\t\t\treturn res.title;\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.controller('RecurrenceController', RecurrenceController);\r\n\r\n\tRecurrenceController.$inject = ['recurrenceModalService'];\r\n\tfunction RecurrenceController(recurrenceModalService) {\r\n\t\tvar rc = this;\r\n\t\trc.showRecurrenceModal = showRecurrenceModal;\r\n\r\n\t\tfunction showRecurrenceModal() {\r\n\t\t\tif (rc.item.recurrence) {\r\n\t\t\t\trecurrenceModalService.openRecurrenceModal(rc.item);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.directive('spRepeat', recurrenceDirective);\r\n\r\n\tfunction recurrenceDirective() {\r\n\t\treturn {\r\n\t\t\ttemplateUrl: 'modules/activities/recurrence/recurrence.html',\r\n\t\t\tcontroller: 'RecurrenceController',\r\n\t\t\tcontrollerAs: 'rc',\r\n\t\t\tbindToController: true,\r\n\t\t\tscope: {\r\n\t\t\t\titem: '='\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('recurrenceService', recurrenceService);\r\n\r\n\tfunction recurrenceService() {\r\n\t\tvar recurrenceCols = {\r\n\t\t\tfreq: ['hourly', 'daily', 'weekly', 'monthly', 'yearly'],\r\n\t\t\tdays: ['mo', 'tu', 'we', 'th', 'fr', 'sa', 'su'],\r\n\t\t\tby: ['by_hour', 'by_day', 'by_month_day', 'by_year_day', 'by_week_no', 'by_month']\r\n\t\t};\r\n\r\n\t\treturn {\r\n\t\t\tclearRecurrence: clearRecurrence,\r\n\t\t\tconstructRecurrence: constructRecurrence\r\n\t\t};\r\n\r\n\t\tfunction clearRecurrence(item) {\r\n\t\t\titem.recurrence = false;\r\n\t\t}\r\n\r\n\t\tfunction constructRecurrence(item) {\r\n\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.controller('TasksController', TasksController);\r\n\r\n\tTasksController.$inject = ['$rootScope', 'tasksService', 'labelService', 'taskModalService'];\r\n\tfunction TasksController($rootScope, tasksService, labelService, taskModalService) {\r\n\t\tvar vm = this;\r\n\t\tvm.labels = [];\r\n\t\tvm.tasks = [];\r\n\t\tvm.showTaskModal = showTaskModal;\r\n\t\tvm.toggleCompleted = toggleCompleted;\r\n\r\n\t\tactivate();\r\n\r\n\t\tfunction activate() {\r\n\t\t\tupdateLabels();\r\n\t\t\tupdateTasks();\r\n\r\n\t\t\t$rootScope.$on('updateLabels', updateLabels);\r\n\t\t\t$rootScope.$on('updateTasks', updateTasks);\r\n\t\t}\r\n\r\n\t\tfunction showTaskModal(task) {\r\n\t\t\ttaskModalService.openTaskModal(task, vm.labels);\r\n\t\t}\r\n\r\n\t\tfunction toggleCompleted(task) {\r\n\t\t\ttasksService.toggleCompleted(task);\r\n\t\t}\r\n\r\n\t\tfunction updateLabels() {\r\n\t\t\tvm.labels = labelService.getLabels();\r\n\t\t}\r\n\r\n\t\tfunction updateTasks() {\r\n\t\t\tvm.tasks = tasksService.getTasks();\r\n\t\t}\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.directive('spTasks', tasksDirective);\r\n\r\n\tfunction tasksDirective() {\r\n\t\treturn {\r\n\t\t\ttemplateUrl: 'modules/activities/tasks/tasks.html',\r\n\t\t\tcontroller: 'TasksController',\r\n\t\t\tcontrollerAs: 'vm',\r\n\t\t\tbindToController: true,\r\n\t\t\tscope: {\r\n\t\t\t\torder: '=',\r\n\t\t\t\tdays: '=withinDays',\r\n\t\t\t\tinLabels: '=inGroups'\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('tasksService', tasksService);\r\n\r\n\ttasksService.$inject = ['crudService', 'cacheService'];\r\n\tfunction tasksService(crudService, cacheService) {\r\n\t\tvar vm = this;  // jshint ignore:line\r\n\t\tvm.task = new crudService('task');\r\n\r\n\t\treturn {\r\n\t\t\tcreateTask: createTask,\r\n\t\t\tcreateOrUpdateTask: createOrUpdateTask,\r\n\t\t\tdeleteTask: deleteTask,\r\n\t\t\tgetTasks: getTasks,\r\n\t\t\ttoggleCompleted: toggleCompleted,\r\n\t\t\tupdateTask: updateTask\r\n\t\t};\r\n\r\n\t\tfunction createTask(task) {\r\n\t\t\treturn vm.task.create(task).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction createOrUpdateTask(task) {\r\n\t\t\tif (!task.task_id) {\r\n\t\t\t\treturn createTask(task);\r\n\t\t\t}\r\n\t\t\treturn updateTask(task.task_id, task);\r\n\t\t}\r\n\r\n\t\tfunction deleteTask(id) {\r\n\t\t\treturn vm.task.remove(id).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction getTasks() {\r\n\t\t\treturn cacheService.getTasks();\r\n\t\t}\r\n\r\n\t\tfunction toggleCompleted(task) {\r\n\t\t\ttask.completed = !parseInt(task.completed);\r\n\t\t\treturn updateTask(task.task_id, task).then(getTasks);\r\n\t\t}\r\n\r\n\t\tfunction updateTask(id, task) {\r\n\t\t\treturn vm.task.update(id, task).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction promiseComplete(response) {\r\n\t\t\tvar res = response.data;\r\n\t\t\tif (res.success) {\r\n\t\t\t\tcacheService.cacheTasks();\r\n\t\t\t\treturn res.data;\r\n\t\t\t}\r\n\t\t\treturn res.title;\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('calendarUserService', calendarUserService);\r\n\r\n\tcalendarUserService.$inject = ['crudService'];\r\n\tfunction calendarUserService(crudService) {\r\n\t\tvar vm = this;  // jshint ignore:line\r\n\t\tvm.calendarUser = new crudService('calendarUser');\r\n\r\n\t\treturn {\r\n\t\t\tcreateCalendarUser: createCalendarUser,\r\n\t\t\tcreateOrUpdateCalendarUser: createOrUpdateCalendarUser,\r\n\t\t\tdeleteCalendarUser: deleteCalendarUser,\r\n\t\t\tgetSharedCalendars: getSharedCalendars,\r\n\t\t\tgetSharedUsersForCalendar: getSharedUsersForCalendar,\r\n\t\t\tgetEventsForCalendar: getEventsForCalendar,\r\n\t\t\tupdateCalendarUser: updateCalendarUser\r\n\t\t};\r\n\r\n\t\tfunction createCalendarUser(calendarUser) {\r\n\t\t\treturn vm.calendarUser.create(calendarUser).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction createOrUpdateCalendarUser(calendarUser) {\r\n\t\t\tif (!calendarUser.calendarUser_id) {\r\n\t\t\t\treturn createCalendarUser(calendarUser);\r\n\t\t\t}\r\n\t\t\treturn updateCalendarUser(calendarUser.calendarUser_id, calendarUser);\r\n\t\t}\r\n\r\n\t\tfunction deleteCalendarUser(id) {\r\n\t\t\treturn vm.calendarUser.remove(id).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\t// TODO: fix this filthy override done for the sake of time.\r\n\t\tfunction getSharedCalendars() {\r\n\t\t\treturn vm.calendarUser.getWhere('groups', {}).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction getSharedUsersForCalendar() {\r\n\t\t\treturn vm.calendarUser.getWhere('users', {}).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction getEventsForCalendar() {\r\n\t\t\treturn vm.calendarUser.getWhere('activities', {}).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction updateCalendarUser(id, calendarUser) {\r\n\t\t\treturn vm.calendarUser.update(id, calendarUser).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction promiseComplete(response) {\r\n\t\t\tvar res = response.data;\r\n\t\t\tif (res.success) {\r\n\t\t\t\treturn res.data;\r\n\t\t\t}\r\n\t\t\treturn res.title;\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('labelUserService', labelUserService);\r\n\r\n\tlabelUserService.$inject = ['crudService'];\r\n\tfunction labelUserService(crudService) {\r\n\t\tvar vm = this;  // jshint ignore:line\r\n\t\tvm.labelUser = new crudService('labelUser');\r\n\r\n\t\treturn {\r\n\t\t\tcreateLabelUser: createLabelUser,\r\n\t\t\tcreateOrUpdateLabelUser: createOrUpdateLabelUser,\r\n\t\t\tdeleteLabelUser: deleteLabelUser,\r\n\t\t\tgetSharedLabels: getSharedLabels,\r\n\t\t\tgetSharedUsersForLabel: getSharedUsersForLabel,\r\n\t\t\tgetEventsForLabel: getEventsForLabel,\r\n\t\t\tupdateLabelUser: updateLabelUser\r\n\t\t};\r\n\r\n\t\tfunction createLabelUser(labelUser) {\r\n\t\t\treturn vm.labelUser.create(labelUser).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction createOrUpdateLabelUser(labelUser) {\r\n\t\t\tif (!labelUser.labelUser_id) {\r\n\t\t\t\treturn createLabelUser(labelUser);\r\n\t\t\t}\r\n\t\t\treturn updateLabelUser(labelUser.labelUser_id, labelUser);\r\n\t\t}\r\n\r\n\t\tfunction deleteLabelUser(id) {\r\n\t\t\treturn vm.labelUser.remove(id).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\t// TODO: fix this filthy override done for the sake of time.\r\n\t\tfunction getSharedLabels() {\r\n\t\t\treturn vm.labelUser.getWhere('groups', {}).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction getSharedUsersForLabel() {\r\n\t\t\treturn vm.labelUser.getWhere('users', {}).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction getEventsForLabel() {\r\n\t\t\treturn vm.labelUser.getWhere('activities', {}).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction updateLabelUser(id, labelUser) {\r\n\t\t\treturn vm.labelUser.update(id, labelUser).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction promiseComplete(response) {\r\n\t\t\tvar res = response.data;\r\n\t\t\tif (res.success) {\r\n\t\t\t\treturn res.data;\r\n\t\t\t}\r\n\t\t\treturn res.title;\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\t// TODO: separate into labelUser and calendarUser modal services\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('collabModalService', collabModalService);\r\n\r\n\tcollabModalService.$inject = ['$uibModal', 'tasksService'];\r\n\tfunction collabModalService($uibModal, tasksService) {\r\n\t\treturn {\r\n\t\t\topenCollabModal: openCollabModal\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t* Without cloning the item, any changes made in the modal will be reflected\r\n\t\t* in the main window regardless of if the changes were saved or not, which\r\n\t\t* means a user would not be able to cancel their changes unless they refresh.\r\n\t\t*/\r\n\t\tfunction openCollabModal(item, labels) {\r\n\t\t\tvar clonedItem = {};\r\n\t\t\tangular.extend(clonedItem, item);\r\n\r\n\t\t\treturn $uibModal.open({\r\n\t\t\t\tcontroller: 'ModalController',\r\n\t\t\t\tcontrollerAs: 'vm',\r\n\t\t\t\ttemplateUrl: 'modules/collab/modal.modal.html',\r\n\t\t\t\tresolve: {\r\n\t\t\t\t\tgroups: {},\r\n\t\t\t\t\titem: clonedItem\r\n\t\t\t\t}\r\n\t\t\t}).result\r\n\t\t\t\t.then(function(response) {\r\n\t\t\t\t\treturn tasksService.createOrUpdateTask(response)\r\n\t\t\t\t\t\t.then(tasksService.getTasks);\r\n\t\t\t\t}, function(response) {\r\n\t\t\t\t\tif (Number(response)) {\r\n\t\t\t\t\t\treturn tasksService.deleteTask(response)\r\n\t\t\t\t\t\t\t.then(tasksService.getTasks);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('userModalService', userModalService);\r\n\r\n\tuserModalService.$inject = ['$uibModal', 'userService'];\r\n\tfunction userModalService($uibModal, userService) {\r\n\t\treturn {\r\n\t\t\topenUserModal: openUserModal\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t* Without cloning the user, any changes made in the modal will be reflected\r\n\t\t* in the main window regardless of if the changes were saved or not, which\r\n\t\t* means a user would not be able to cancel their changes unless they refresh.\r\n\t\t*/\r\n\t\tfunction openUserModal(user) {\r\n\t\t\tvar clonedUser = {};\r\n\t\t\tangular.extend(clonedUser, user);\r\n\r\n\t\t\treturn $uibModal.open({\r\n\t\t\t\tcontroller: 'ModalController',\r\n\t\t\t\tcontrollerAs: 'vm',\r\n\t\t\t\ttemplateUrl: 'pages/admin/modal/user.modal.html',\r\n\t\t\t\tresolve: {\r\n\t\t\t\t\tgroups: {},\r\n\t\t\t\t\titem: clonedUser\r\n\t\t\t\t}\r\n\t\t\t}).result\r\n\t\t\t\t.then(function(response) {\r\n\t\t\t\t\treturn userService.createOrUpdateUser(response)\r\n\t\t\t\t\t\t.then(userService.getUsers);\r\n\t\t\t\t}, function(response) {\r\n\t\t\t\t\tif (Number(response)) {\r\n\t\t\t\t\t\treturn userService.deleteUser(response)\r\n\t\t\t\t\t\t\t.then(userService.getUsers);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('userService', userService);\r\n\r\n\tuserService.$inject = ['crudService'];\r\n\tfunction userService(crudService) {\r\n\t\tvar vm = this;  // jshint ignore:line\r\n\t\tvm.user = new crudService('user');\r\n\r\n\t\treturn {\r\n\t\t\tcreateUser: createUser,\r\n\t\t\tcreateOrUpdateUser: createOrUpdateUser,\r\n\t\t\tdeleteUser: deleteUser,\r\n\t\t\tgetUsers: getUsers,\r\n\t\t\tupdateUser: updateUser\r\n\t\t};\r\n\r\n\t\tfunction createUser(user) {\r\n\t\t\treturn vm.user.create(user).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction createOrUpdateUser(user) {\r\n\t\t\tif (!user.id) {\r\n\t\t\t\treturn createUser(user);\r\n\t\t\t}\r\n\t\t\treturn updateUser(user.id, user);\r\n\t\t}\r\n\r\n\t\tfunction deleteUser(id) {\r\n\t\t\treturn vm.user.remove(id).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction getUsers() {\r\n\t\t\treturn vm.user.getWhere('', {}).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction updateUser(id, user) {\r\n\t\t\treturn vm.user.update(id, user).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction promiseComplete(response) {\r\n\t\t\tvar res = response.data;\r\n\t\t\tif (res.success) {\r\n\t\t\t\treturn res.data;\r\n\t\t\t}\r\n\t\t\treturn res.title;\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.controller('HeaderController', HeaderController);\r\n\r\n\tHeaderController.$inject = ['$rootScope', 'user', 'headerService'];\r\n\tfunction HeaderController($rootScope, user, headerService) {\r\n\t\tvar vm = this;\r\n\t\tvm.user = user;\r\n\r\n\t\tactivate();\r\n\r\n\t\tfunction activate() {\r\n\t\t\t$rootScope.$on('updateUser', updateUser);\r\n\t\t}\r\n\r\n\t\tfunction updateUser() {\r\n\t\t\theaderService.getUser().then(function(response) {\r\n\t\t\t\tvm.user = response;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('headerService', headerService);\r\n\r\n\theaderService.$inject = ['$http', '$log', 'sessionService'];\r\n\tfunction headerService($http, $log, sessionService) {\r\n\t\treturn {\r\n\t\t\tgetUser: getUser\r\n\t\t};\r\n\r\n\t\tfunction getUser() {\r\n\t\t\treturn sessionService.getVar('all')\r\n\t\t\t\t.then(getNameComplete);\r\n\r\n\t\t\tfunction getNameComplete(response) {\r\n\t\t\t\tvar result = response.data;\r\n\r\n\t\t\t\tif (result.success === false) {\r\n\t\t\t\t\treturn { name: '', avatar: 'content/img/user.png' };\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn result.data;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.controller('SidebarController', SidebarController);\r\n\r\n\tSidebarController.$inject = ['$rootScope', 'labelService', 'calendarService', 'sidebarService'];\r\n\tfunction SidebarController($rootScope, labelService, calendarService, sidebarService) {\r\n\t\tvar vm = this;\r\n\t\tvm.collapsed = {};\r\n\t\tvm.labels = [];\r\n\t\tvm.calendars = [];\r\n\r\n\t\tvm.toggleSidebar = toggleSidebar;\r\n\t\tvm.toggleCalendars = toggleCalendars;\r\n\t\tvm.toggleLabels = toggleLabels;\r\n\r\n\t\tactivate();\r\n\r\n\t\tfunction activate() {\r\n\t\t\tupdateCalendars();\r\n\t\t\tupdateLabels();\r\n\r\n\t\t\tvm.collapsed = sidebarService.getCollapsed();\r\n\r\n\t\t\t$rootScope.$on('updateCalendars', updateCalendars);\r\n\t\t\t$rootScope.$on('updateLabels', updateLabels);\r\n\t\t}\r\n\r\n\t\tfunction toggleSidebar() {\r\n\t\t\tvm.collapsed = sidebarService.toggleSidebar();\r\n\t\t}\r\n\r\n\t\tfunction toggleCalendars() {\r\n\t\t\tvm.collapsed = sidebarService.toggleCalendars();\r\n\t\t}\r\n\r\n\t\tfunction toggleLabels() {\r\n\t\t\tvm.collapsed = sidebarService.toggleLabels();\r\n\t\t}\r\n\r\n\t\tfunction updateCalendars() {\r\n\t\t\tvm.calendars = calendarService.getCalendars();\r\n\t\t}\r\n\r\n\t\tfunction updateLabels() {\r\n\t\t\tvm.labels = labelService.getLabels();\r\n\t\t}\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('sidebarService', sidebarService);\r\n\r\n\tsidebarService.$inject = ['$window'];\r\n\tfunction sidebarService($window) {\r\n\t\tvar vm = this; // jshint ignore: line\r\n\t\tvm.collapsed = {};\r\n\r\n\t\tactivate();\r\n\r\n\t\treturn {\r\n\t\t\tgetCollapsed: getCollapsed,\r\n\t\t\ttoggleSidebar: toggleSidebar,\r\n\t\t\ttoggleCalendars: toggleCalendars,\r\n\t\t\ttoggleLabels: toggleLabels\r\n\t\t};\r\n\r\n\t\tfunction activate() {\r\n\t\t\tif ($window.innerWidth < 600) {\r\n\t\t\t\tvm.collapsed = {\r\n\t\t\t\t\tsidebar: true,\r\n\t\t\t\t\tcalendars: true,\r\n\t\t\t\t\tlabels: true\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\tvm.collapsed = {\r\n\t\t\t\t\tsidebar: false,\r\n\t\t\t\t\tcalendars: false,\r\n\t\t\t\t\tlabels: false\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction getCollapsed() {\r\n\t\t\treturn vm.collapsed;\r\n\t\t}\r\n\r\n\t\tfunction toggleSidebar() {\r\n\t\t\tvm.collapsed.sidebar = !vm.collapsed.sidebar;\r\n\t\t\tif (vm.collapsed.sidebar) {\r\n\t\t\t\tvm.collapsed.calendars = true;\r\n\t\t\t\tvm.collapsed.labels = true;\r\n\t\t\t}\r\n\t\t\treturn vm.collapsed;\r\n\t\t}\r\n\r\n\t\tfunction toggleCalendars() {\r\n\t\t\tvm.collapsed.calendars = !vm.collapsed.calendars;\r\n\t\t\tif (!vm.collapsed.calendars) {\r\n\t\t\t\tvm.collapsed.sidebar = false;\r\n\t\t\t}\r\n\t\t\treturn vm.collapsed;\r\n\t\t}\r\n\r\n\t\tfunction toggleLabels() {\r\n\t\t\tvm.collapsed.labels = !vm.collapsed.labels;\r\n\t\t\tif (!vm.collapsed.labels) {\r\n\t\t\t\tvm.collapsed.sidebar = false;\r\n\t\t\t}\r\n\t\t\treturn vm.collapsed;\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('calendarService', calendarService);\r\n\r\n\tcalendarService.$inject = ['crudService', 'cacheService'];\r\n\tfunction calendarService(crudService, cacheService) {\r\n\t\tvar vm = this;  // jshint ignore:line\r\n\t\tvm.calendar = new crudService('calendar');\r\n\r\n\t\treturn {\r\n\t\t\tcreateCalendar: createCalendar,\r\n\t\t\tdeleteCalendar: deleteCalendar,\r\n\t\t\tgetCalendars: getCalendars,\r\n\t\t\tupdateCalendar: updateCalendar\r\n\t\t};\r\n\r\n\t\tfunction createCalendar(calendar) {\r\n\t\t\treturn vm.calendar.create(calendar).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction deleteCalendar(id) {\r\n\t\t\treturn vm.calendar.remove(id).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction getCalendars() {\r\n\t\t\treturn cacheService.getCalendars();\r\n\t\t}\r\n\r\n\t\tfunction updateCalendar(id, calendar) {\r\n\t\t\treturn vm.calendar.update(id, calendar).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction promiseComplete(response) {\r\n\t\t\tvar result = response.data;\r\n\t\t\tif (result.success) {\r\n\t\t\t\tcacheService.cacheCalendars();\r\n\t\t\t\treturn result.data;\r\n\t\t\t}\r\n\t\t\treturn result.title;\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('eventModalService', eventModalService);\r\n\r\n\teventModalService.$inject = ['$uibModal', 'moment', 'eventsService', 'formatService'];\r\n\tfunction eventModalService($uibModal, moment, eventsService, formatService) {\r\n\t\treturn {\r\n\t\t\topenEventModal: openEventModal,\r\n\t\t\ttoggleAllDay: toggleAllDay\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t* Without cloning the event, any changes made in the modal will be reflected\r\n\t\t* in the main window regardless of if the changes were saved or not, which\r\n\t\t* means a user would not be able to cancel their changes unless they refresh.\r\n\t\t*/\r\n\t\tfunction openEventModal(event, calendars) {\r\n\t\t\tvar clonedEvent = {};\r\n\t\t\tangular.extend(clonedEvent, event);\r\n\t\t\tformatService.formatForDisplay(clonedEvent);\r\n\r\n\t\t\treturn $uibModal.open({\r\n\t\t\t\tcontroller: 'ModalController',\r\n\t\t\t\tcontrollerAs: 'vm',\r\n\t\t\t\ttemplateUrl: 'modules/activities/events/modal/event.modal.html',\r\n\t\t\t\tresolve: {\r\n\t\t\t\t\tgroups: function() { return calendars; },\r\n\t\t\t\t\titem: clonedEvent\r\n\t\t\t\t}\r\n\t\t\t}).result\r\n\t\t\t\t.then(function(response) {\r\n\t\t\t\t\tformatService.formatForStorage(response);\r\n\t\t\t\t\treturn eventsService.createOrUpdateEvent(response)\r\n\t\t\t\t\t\t.then(eventsService.getEvents);\r\n\t\t\t\t}, function(response) {\r\n\t\t\t\t\tif (Number(response)) {\r\n\t\t\t\t\t\treturn eventsService.deleteEvent(response)\r\n\t\t\t\t\t\t\t.then(eventsService.getEvents);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction toggleAllDay(event) {\r\n\t\t\tvar display = formatService.getDisplayFormat();\r\n\r\n\t\t\tif (event.all_day) {\r\n\t\t\t\tevent.dt_start = formatService.toDisplayFormat(moment(event.dt_start, display).startOf('day'));\r\n\t\t\t\tevent.dt_end = formatService.toDisplayFormat(moment(event.dt_start, display).endOf('day'));\r\n\t\t\t} else {\r\n\t\t\t\tvar currentHour = moment().startOf('hour').hour();\r\n\t\t\t\tevent.dt_start = formatService.toDisplayFormat(moment(event.dt_start, display).hour(currentHour));\r\n\t\t\t\tevent.dt_end = formatService.toDisplayFormat(moment(event.dt_start, display).hour(currentHour).add(1, 'hours'));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('calendarWidgetService', calendarWidgetService);\r\n\r\n\tcalendarWidgetService.$inject = ['moment', 'eventModalService'];\r\n\tfunction calendarWidgetService(moment, eventModalService) {\r\n\t\treturn {\r\n\t\t\tdayClicked: dayClicked,\r\n\t\t\tgetMonth: getMonth,\r\n\t\t\tgetToday: getToday,\r\n\t\t\tgetWeek: getWeek,\r\n\t\t\tisSameDay: isSameDay,\r\n\t\t\tlastMonth: lastMonth,\r\n\t\t\tnextMonth: nextMonth,\r\n\t\t\tshowEventModal: showEventModal\r\n\t\t};\r\n\r\n\t\tfunction dayClicked(clickEvent, day, selectedDay, calendars) {\r\n\t\t\tif (isSameDay(day.fullDate, selectedDay)) {\r\n\t\t\t\tshowEventModal(\r\n\t\t\t\t\tclickEvent,\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdt_start: day.fullDate,\r\n\t\t\t\t\t\tdt_end: day.fullDate.clone().endOf('day'),\r\n\t\t\t\t\t\tall_day: 1,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcalendars\r\n\t\t\t\t);\r\n\t\t\t\treturn selectedDay;\r\n\t\t\t}\r\n\t\t\treturn day.fullDate;\r\n\t\t}\r\n\t\t/**\r\n\t\t* @param {Moment Object} aDay Day to build month around.\r\n\t\t* @return {Moment Object[][]}\r\n\t\t*/\r\n\t\tfunction getMonth(aDay) {\r\n\t\t\tvar month = [];\r\n\t\t\tvar day = aDay.clone().date(1).startOf('week');\r\n\t\t\tfor (var i = 0; i < 6; i++) {\r\n\t\t\t\tmonth.push(getWeek(day, aDay.month()));\r\n\t\t\t\tday = day.add(1, 'weeks');\r\n\t\t\t}\r\n\t\t\treturn month;\r\n\t\t}\r\n\r\n\t\tfunction getToday() {\r\n\t\t\treturn moment();\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t* @param {Moment Object}\tstartDay\tStarting day of a week.\r\n\t\t* @param {int}\t\t\t\ttargetMonth\tMonth number being built.\r\n\t\t*\r\n\t\t* @return {Moment Object[]}\r\n\t\t*/\r\n\t\tfunction getWeek(startDay, targetMonth) {\r\n\t\t\tvar week = [];\r\n\r\n\t\t\tvar day = startDay.clone();\r\n\t\t\tfor (var i = 0; i < 7; i++) {\r\n\t\t\t\tweek.push({\r\n\t\t\t\t\tnumber: day.date(),\r\n\t\t\t\t\tisTargetMonth: (day.month() === targetMonth),\r\n\t\t\t\t\tisToday: day.isSame(moment(), 'day'),\r\n\t\t\t\t\tfullDate: day\r\n\t\t\t\t});\r\n\t\t\t\tday = day.clone().add(1, 'days');\r\n\t\t\t}\r\n\r\n\t\t\treturn week;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t* @param {Moment Object}\tday1\r\n\t\t* @param {Moment Object}\tday2\r\n\t\t*\r\n\t\t* @return {bool}\r\n\t\t*/\r\n\t\tfunction isSameDay(day1, day2) {\r\n\t\t\treturn day1.isSame(day2, 'day');\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t* Since srcMonth is an array of days by weeks, it contains days not in the\r\n\t\t* source month. The first day of the third week of the given month is\r\n\t\t* guaranteed to be a day within the source month.\r\n\t\t*\r\n\t\t* @param {Moment Object}\tsrcMonth\r\n\t\t* @return {Moment Object[]}\r\n\t\t*/\r\n\t\tfunction lastMonth(srcMonth) {\r\n\t\t\treturn getMonth(srcMonth[3][0].fullDate.clone().subtract(1, 'months'));\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t* @see lastMonth()\r\n\t\t*/\r\n\t\tfunction nextMonth(srcMonth) {\r\n\t\t\treturn getMonth(srcMonth[3][0].fullDate.clone().add(1, 'months'));\r\n\t\t}\r\n\r\n\t\tfunction showEventModal(clickEvent, event, calendars) {\r\n\t\t\tclickEvent.stopPropagation();\r\n\t\t\teventModalService.openEventModal(event, calendars);\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('recurrenceModalService', recurrenceModalService);\r\n\r\n\trecurrenceModalService.$inject = ['$uibModal', 'recurrenceService'];\r\n\tfunction recurrenceModalService($uibModal, recurrenceService) {\r\n\t\tvar rc = this; // jshint ignore: line\r\n\t\tvar recurrenceInfo = {\r\n\t\t\tfreq: ['hourly', 'daily', 'weekly', 'monthly', 'yearly'],\r\n\t\t\tdays: ['mo', 'tu', 'we', 'th', 'fr', 'sa', 'su']\r\n\t\t};\r\n\r\n\t\treturn {\r\n\t\t\topenRecurrenceModal: openRecurrenceModal\r\n\t\t};\r\n\r\n\t\tfunction openRecurrenceModal(item) {\r\n\t\t\treturn $uibModal.open({\r\n\t\t\t\tcontroller: 'ModalController',\r\n\t\t\t\tcontrollerAs: 'vm',\r\n\t\t\t\ttemplateUrl: 'modules/activities/recurrence/modal/recurrence.modal.html',\r\n\t\t\t\tresolve: {\r\n\t\t\t\t\tgroups: function() { return recurrenceInfo; },\r\n\t\t\t\t\titem: item\r\n\t\t\t\t}\r\n\t\t\t}).result\r\n\t\t\t\t.then(function(response) {\r\n\t\t\t\t\trecurrenceService.constructRecurrence(item);\r\n\t\t\t\t}, function(response) {\r\n\t\t\t\t\trecurrenceService.clearRecurrence(item);\r\n\t\t\t\t});\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('labelService', labelService);\r\n\r\n\tlabelService.$inject = ['crudService', 'cacheService'];\r\n\tfunction labelService(crudService, cacheService) {\r\n\t\tvar vm = this;  // jshint ignore:line\r\n\t\tvm.label = new crudService('label');\r\n\r\n\t\treturn {\r\n\t\t\tcreateLabel: createLabel,\r\n\t\t\tdeleteLabel: deleteLabel,\r\n\t\t\tgetLabels: getLabels,\r\n\t\t\tupdateLabel: updateLabel\r\n\t\t};\r\n\r\n\t\tfunction createLabel(label) {\r\n\t\t\treturn vm.label.create(label).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction deleteLabel(id) {\r\n\t\t\treturn vm.label.remove(id).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction getLabels() {\r\n\t\t\treturn cacheService.getLabels();\r\n\t\t}\r\n\r\n\t\tfunction updateLabel(id, label) {\r\n\t\t\treturn vm.label.update(id, label).then(promiseComplete);\r\n\t\t}\r\n\r\n\t\tfunction promiseComplete(response) {\r\n\t\t\tvar res = response.data;\r\n\t\t\tif (res.success) {\r\n\t\t\t\tcacheService.cacheLabels();\r\n\t\t\t\treturn res.data;\r\n\t\t\t}\r\n\t\t\treturn res.title;\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('subtaskModalService', subtaskModalService);\r\n\r\n\tsubtaskModalService.$inject = ['$uibModal', 'labelService', 'subtasksService'];\r\n\tfunction subtaskModalService($uibModal, labelService, subtasksService) {\r\n\t\treturn {\r\n\t\t\topenSubtaskModal: openSubtaskModal\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t* Without cloning the subtask, any changes made in the modal will be reflected\r\n\t\t* in the main window regardless of if the changes were saved or not, which\r\n\t\t* means a user would not be able to cancel their changes unless they refresh.\r\n\t\t*/\r\n\t\tfunction openSubtaskModal(subtask, task) {\r\n\t\t\tvar clonedSubtask = {};\r\n\t\t\tangular.extend(clonedSubtask, subtask);\r\n\r\n\t\t\t$uibModal.open({\r\n\t\t\t\tcontroller: 'ModalController',\r\n\t\t\t\tcontrollerAs: 'vm',\r\n\t\t\t\ttemplateUrl: 'modules/activities/tasks/modal/subtask.modal.html',\r\n\t\t\t\tresolve: {\r\n\t\t\t\t\tgroups: task,\r\n\t\t\t\t\titem: clonedSubtask\r\n\t\t\t\t}\r\n\t\t\t}).result\r\n\t\t\t\t.then(function(res) {\r\n\t\t\t\t\tsubtasksService.createOrUpdateSubtask(res.subtask, res.task);\r\n\t\t\t\t}, function(res) {\r\n\t\t\t\t\tif (typeof res !== 'string') {\r\n\t\t\t\t\t\tsubtasksService.deleteSubtask(res.subtask, res.task);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('taskModalService', taskModalService);\r\n\r\n\ttaskModalService.$inject = ['$uibModal', 'tasksService', 'formatService'];\r\n\tfunction taskModalService($uibModal, tasksService, formatService) {\r\n\t\tvar vm = this; // jshint ignore: line\r\n\r\n\t\treturn {\r\n\t\t\topenTaskModal: openTaskModal\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t* Without cloning the task, any changes made in the modal will be reflected\r\n\t\t* in the main window regardless of if the changes were saved or not, which\r\n\t\t* means a user would not be able to cancel their changes unless they refresh.\r\n\t\t*/\r\n\t\tfunction openTaskModal(task, labels) {\r\n\t\t\tvar clonedTask = {};\r\n\t\t\tangular.extend(clonedTask, task);\r\n\t\t\tformatService.formatForDisplay(clonedTask);\r\n\r\n\t\t\treturn $uibModal.open({\r\n\t\t\t\tcontroller: 'ModalController',\r\n\t\t\t\tcontrollerAs: 'vm',\r\n\t\t\t\ttemplateUrl: 'modules/activities/tasks/modal/task.modal.html',\r\n\t\t\t\tresolve: {\r\n\t\t\t\t\tgroups: function() { return labels; },\r\n\t\t\t\t\titem: clonedTask\r\n\t\t\t\t}\r\n\t\t\t}).result\r\n\t\t\t\t.then(function(response) {\r\n\t\t\t\t\tresponse = formatService.formatForStorage(response);\r\n\t\t\t\t\treturn tasksService.createOrUpdateTask(response)\r\n\t\t\t\t\t\t.then(tasksService.getTasks);\r\n\t\t\t\t}, function(response) {\r\n\t\t\t\t\tif (Number(response)) {\r\n\t\t\t\t\t\treturn tasksService.deleteTask(response)\r\n\t\t\t\t\t\t\t.then(tasksService.getTasks);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t}\r\n\t}\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.controller('SubtasksController', SubtasksController);\r\n\r\n\tSubtasksController.$inject = ['subtasksService', 'subtaskModalService'];\r\n\tfunction SubtasksController(subtasksService, subtaskModalService) {\r\n\t\tvar st = this;\r\n\t\tst.showSubtaskModal = showSubtaskModal;\r\n\t\tst.toggleCompleted = toggleCompleted;\r\n\r\n\t\tfunction showSubtaskModal(subtask) {\r\n\t\t\tsubtaskModalService.openSubtaskModal(subtask, st.task);\r\n\t\t}\r\n\r\n\t\tfunction toggleCompleted(subtask) {\r\n\t\t\tsubtasksService.toggleCompleted(subtask);\r\n\t\t}\r\n\r\n\t\tfunction updateSubtasks(response) {\r\n\t\t\tif (response) {\r\n\t\t\t\tst.subtasks = response;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.directive('spSubtasks', subtasksDirective);\r\n\r\n\tfunction subtasksDirective() {\r\n\t\treturn {\r\n\t\t\ttemplateUrl: 'modules/activities/tasks/subtasks/subtasks.html',\r\n\t\t\tcontroller: 'SubtasksController',\r\n\t\t\tcontrollerAs: 'st',\r\n\t\t\tbindToController: true,\r\n\t\t\tscope: {\r\n\t\t\t\ttask: '='\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n})();\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.factory('subtasksService', subtasksService);\r\n\r\n\tsubtasksService.$inject = ['$http', '$log'];\r\n\tfunction subtasksService($http, $log) {\r\n\t\treturn {\r\n\t\t\tcreateOrUpdateSubtask: createOrUpdateSubtask,\r\n\t\t\tdeleteSubtask: deleteSubtask,\r\n\t\t\ttoggleCompleted: toggleCompleted\r\n\t\t};\r\n\r\n\t\tfunction createOrUpdateSubtask(subtask, task) {\r\n\t\t\tif (!task.subtasks) {\r\n\t\t\t\ttask.subtasks = {\r\n\t\t\t\t\tcurrentId: 1,\r\n\t\t\t\t\tlist: []\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tif (subtask.id === undefined) {\r\n\t\t\t\tsubtask.id = task.subtasks.currentId++;\r\n\t\t\t\tsubtask.completed = false;\r\n\t\t\t\ttask.subtasks.list.push(subtask);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction deleteSubtask(subtask, task) {\r\n\t\t\ttask.subtasks.list.splice(task.subtasks.list.indexOf(subtask), 1);\r\n\t\t}\r\n\r\n\t\tfunction toggleCompleted(subtask) {\r\n\t\t\tsubtask.completed = !subtask.completed;\r\n\t\t}\r\n\t}\r\n})();\r\n"],"sourceRoot":"/source/"}